<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∏—Å–∫–∞ –ø—Ä–µ—ç–∫–ª–∞–º–ø—Å–∏–∏ –∏ –∑–∞–¥–µ—Ä–∂–∫–∏ —Ä–æ—Å—Ç–∞ –ø–ª–æ–¥–∞ (CDSS)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à—Ä–∏—Ñ—Ç–æ–≤ –∏ —Ü–≤–µ—Ç–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –í–∞—Ä–∏–∞–Ω—Ç—É A */
        body { font-family: 'Montserrat', sans-serif; background-color: #F9FAFB; color: #111827; }
        
        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞: –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–∞—Å—Ç–µ—Ç, –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ - —Ñ–∏–∫—Å */
        @media (min-width: 768px) {
            body { height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
            .main-container { height: 100%; overflow: hidden; }
        }
        @media (max-width: 767px) {
            body { height: auto; overflow-y: auto; }
            .main-container { height: auto; overflow: visible; }
        }
        
        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
        .overflow-y-auto::-webkit-scrollbar { width: 6px; }
        .overflow-y-auto::-webkit-scrollbar-track { background: #f1f5f9; }
        .overflow-y-auto::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }

        /* –ê–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –∫–Ω–æ–ø–æ–∫ (–°–∏–Ω–∏–π –∞–∫—Ü–µ–Ω—Ç) */
        .active-mode { 
            border-color: #3B82F6; 
            background-color: #EFF6FF; 
            color: #1D4ED8; 
            border-width: 2px; 
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal { display: none; position: fixed; z-index: 50; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #ffffff; margin: 3% auto; padding: 25px; border: 1px solid #E5E7EB; width: 90%; max-width: 800px; border-radius: 16px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse-blue { 0%, 100% { background-color: #EFF6FF; } 50% { background-color: #DBEAFE; } }
        .loading-mis { animation: pulse-blue 1.5s infinite; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è inputs –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3B82F6;
            box-shadow: 0 0 0 1px #3B82F6;
        }

        /* Disabled inputs styling */
        input:disabled, select:disabled {
            background-color: #F3F4F6;
            color: #9CA3AF;
            cursor: not-allowed;
        }
        
        /* –°–µ—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ (–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª) */
        .btn-disabled-look {
            background-color: #E5E7EB;
            color: #9CA3AF;
            cursor: pointer; /* –û—Å—Ç–∞–≤–ª—è–µ–º pointer, —á—Ç–æ–±—ã –∫–ª–∏–∫–Ω—É—Ç—å –∏ —É–≤–∏–¥–µ—Ç—å –∞–ª–µ—Ä—Ç */
        }
        .btn-disabled-look:hover {
            background-color: #D1D5DB;
        }
    </style>
</head>
<body class="p-4 md:p-8 text-[13px]">

    <div class="main-container max-w-7xl mx-auto bg-white rounded-2xl shadow-xl flex flex-col border border-gray-200">
        
        <div class="p-5 border-b border-gray-200 bg-white text-center flex-shrink-0">
            <h1 class="text-xl font-bold text-[#111827] uppercase tracking-wide">
                –ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∏—Å–∫–∞ –ø—Ä–µ—ç–∫–ª–∞–º–ø—Å–∏–∏ –∏ –∑–∞–¥–µ—Ä–∂–∫–∏ —Ä–æ—Å—Ç–∞ –ø–ª–æ–¥–∞
                <span class="block text-sm font-normal normal-case text-[#6B7280] mt-1">
                    –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏–Ω—è—Ç–∏—è –≤—Ä–∞—á–µ–±–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π (CDSS) –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω—Å–∞–º–±–ª–µ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
                </span>
            </h1>
        </div>
        
        <header class="px-6 py-4 border-b border-gray-200 bg-[#F9FAFB] flex flex-col md:flex-row justify-between items-center gap-4 flex-shrink-0">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm flex-1 w-full text-[12px]">
                <div class="space-y-1">
                    <label class="text-[#6B7280] block uppercase text-[9px] font-black tracking-tighter">–§–ò–û –ü–∞—Ü–∏–µ–Ω—Ç–∫–∏:</label>
                    <input type="text" id="header-name" value="–ò–≤–∞–Ω–æ–≤–∞ –ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–Ω–∞" class="w-full bg-transparent border-b border-gray-300 focus:border-blue-500 font-bold text-[#111827] py-0.5">
                </div>
                <div class="space-y-1">
                    <label class="text-[#6B7280] block uppercase text-[9px] font-black tracking-tighter">–°—Ä–æ–∫ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏:</label>
                    <select id="header-weeks" class="w-full bg-transparent border-b border-gray-300 focus:border-blue-500 font-bold text-[#111827] py-0.5">
                        <option value="4-6">4-6 –Ω–µ–¥–µ–ª—å</option>
                        <option value="7-9">7-9 –Ω–µ–¥–µ–ª—å</option>
                        <option value="10-12">10-12 –Ω–µ–¥–µ–ª—å</option>
                        <option value="13-16" selected>13-16 –Ω–µ–¥–µ–ª—å</option>
                        <option value="17-20">17-20 –Ω–µ–¥–µ–ª—å</option>
                        <option value="21-24">21-24 –Ω–µ–¥–µ–ª—å</option>
                        <option value="25-28">25-28 –Ω–µ–¥–µ–ª—å</option>
                        <option value="29-32">29-32 –Ω–µ–¥–µ–ª—å</option>
                        <option value="33-36">33-36 –Ω–µ–¥–µ–ª—å</option>
                        <option value="37+">‚â•37 –Ω–µ–¥–µ–ª—å</option>
                    </select>
                </div>
                <div class="space-y-1">
                    <label class="text-[#6B7280] block uppercase text-[9px] font-black tracking-tighter">–í—Ä–∞—á (–§–ò–û):</label>
                    <input type="text" id="header-doctor" value="–ü–µ—Ç—Ä–æ–≤ –í.–í." class="w-full bg-transparent border-b border-gray-300 focus:border-blue-500 font-bold text-[#111827] py-0.5">
                </div>
                <div class="space-y-1">
                    <label class="text-[#6B7280] block uppercase text-[9px] font-black tracking-tighter">ID –ü—Ä–æ–ú–µ–¥/–ï–¶–ü:</label>
                    <input type="text" id="header-id" value="7701-12345678" class="w-full bg-transparent border-b border-gray-300 focus:border-blue-500 font-medium text-[#111827] py-0.5">
                </div>
            </div>
            <div class="flex gap-2 w-full md:w-auto">
                <button id="import-mis" class="flex-1 md:flex-none btn-disabled-look text-[10px] font-black py-2.5 px-4 rounded-lg uppercase transition flex items-center justify-center gap-2 shadow-sm" onclick="alert('–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–∞—Ü–∏–µ–Ω—Ç–∫–µ –∏–∑ –ú–ò–° –≤ —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏'); return false;">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                    –ò–º–ø–æ—Ä—Ç –∏–∑ –ú–ò–°
                </button>
            </div>
        </header>

        <main class="flex flex-col md:flex-row flex-1 overflow-hidden text-balance">
            <div id="input-column" class="w-full md:w-5/12 p-6 border-r border-gray-200 overflow-y-auto bg-white transition-colors duration-300">
                <form id="ml-input-form" class="space-y-6">
                    <div class="space-y-4">
                        <div class="flex justify-between items-center border-b-2 border-blue-100 pb-1">
                            <h3 class="font-bold text-[#3B82F6] text-sm uppercase tracking-wider">–ö–ª–∏–Ω–∏–∫–æ-–∞–Ω–∞–º–Ω–µ—Å—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</h3>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-[#6B7280] mb-1">–í–æ–∑—Ä–∞—Å—Ç –º–∞—Ç–µ—Ä–∏ (15-50)</label>
                                <input type="number" id="inp-age" value="35" min="15" max="50" class="block w-full rounded-lg border-gray-300 shadow-sm text-sm p-2">
                                <span id="age-error" class="text-[10px] text-red-500 hidden">–í–æ–∑—Ä–∞—Å—Ç –≤–Ω–µ —Ä–µ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞</span>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-[#6B7280] mb-1">–ß–∏—Å–ª–æ —Ä–æ–¥–æ–≤ (–ø–∞—Ä–∏—Ç–µ—Ç)</label>
                                <input type="number" id="inp-parity" value="1" min="0" max="10" class="block w-full rounded-lg border-gray-300 shadow-sm text-sm p-2">
                            </div>
                            <div class="col-span-2">
                                <label class="block text-xs font-bold text-[#6B7280] mb-1">–ò–Ω—Ç–µ—Ä–≥—Ä–∞–≤–∏–¥–∞—Ä–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª</label>
                                <select id="inp-interval" class="block w-full rounded-lg border-gray-300 shadow-sm text-sm p-2"><option value="norm">–û—Ç 6 –¥–æ 60 –º–µ—Å—è—Ü–µ–≤</option><option value="short">–ú–µ–Ω–µ–µ 6 –º–µ—Å—è—Ü–µ–≤</option><option value="long">–ë–æ–ª–µ–µ 60 –º–µ—Å—è—Ü–µ–≤</option><option value="none">–ù–µ—Ç (–ø–µ—Ä–≤—ã–µ —Ä–æ–¥—ã)</option></select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-[#6B7280] mb-1">–ü–≠ –≤ –∞–Ω–∞–º–Ω–µ–∑–µ</label>
                                <select id="inp-pe-hist" class="block w-full rounded-lg border-gray-300 shadow-sm text-sm p-2"><option>–ù–µ—Ç</option><option>–î–∞</option></select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-[#6B7280] mb-1">–ó–†–ü –≤ –∞–Ω–∞–º–Ω–µ–∑–µ</label>
                                <select id="inp-fgr-hist" class="block w-full rounded-lg border-gray-300 shadow-sm text-sm p-2"><option>–ù–µ—Ç</option><option>–î–∞</option></select>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h3 class="font-bold text-[#3B82F6] border-b-2 border-blue-100 pb-1 text-sm uppercase tracking-wider">–°–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ç—É—Å</h3>
                        
                        <div class="bg-gray-50 p-3 rounded-lg border border-gray-100">
                            <label class="flex items-center gap-2 mb-2 cursor-pointer">
                                <input type="checkbox" id="inp-weight-known" checked class="text-blue-600 rounded focus:ring-blue-500">
                                <span class="text-xs font-bold text-[#111827]">–ò–∑–≤–µ—Å—Ç–Ω–∞ –º–∞—Å—Å–∞ —Ç–µ–ª–∞ –¥–æ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏</span>
                            </label>
                            
                            <div id="weight-fields" class="grid grid-cols-2 gap-3 transition-opacity duration-200">
                                <div><label class="block text-[10px] font-bold text-[#6B7280] mb-1">–ò–ú–¢ –¥–æ –±–µ—Ä-—Ç–∏</label><input type="text" id="inp-bmi" value="31.2" class="block w-full rounded-lg border-gray-300 shadow-sm text-sm p-2"></div>
                                <div>
                                    <label class="block text-[10px] font-bold text-[#6B7280] mb-1">–ü—Ä–∏–±–∞–≤–∫–∞ –≤–µ—Å–∞</label>
                                    <select id="inp-gain" class="block w-full rounded-lg border-gray-300 shadow-sm text-sm p-2"><option>–ú–µ–Ω—å—à–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–π –Ω–æ—Ä–º—ã</option><option selected>–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–æ—Ä–º–µ</option><option>–ë–æ–ª—å—à–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–π –Ω–æ—Ä–º—ã</option></select>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="block text-xs font-bold text-[#6B7280] mb-1">–•—Ä–æ–Ω–∏—á–µ—Å–∫–∞—è –ê–ì</label><select id="inp-hag" class="block w-full rounded-lg border-gray-300 shadow-sm text-sm p-2"><option>–î–∞</option><option>–ù–µ—Ç</option></select></div>
                            <div><label class="block text-xs font-bold text-[#6B7280] mb-1">–ë–æ–ª–µ–∑–Ω–∏ –ø–æ—á–µ–∫</label><select id="inp-kidney" class="block w-full rounded-lg border-gray-300 shadow-sm text-sm p-2"><option>–ù–µ—Ç</option><option>–î–∞</option></select></div>
                            
                            <div class="col-span-2">
                                <label class="flex items-center gap-2 p-2 border border-dashed border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition" id="gag-container" title="–ê–∫—Ç–∏–≤–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ä–æ–∫–µ ‚â•20 –Ω–µ–¥–µ–ª—å">
                                    <input type="checkbox" id="inp-gag" disabled class="text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50">
                                    <div class="flex flex-col">
                                        <span class="text-xs font-bold text-[#111827]" id="gag-label">–ì–µ—Å—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è –ê–ì</span>
                                        <span class="text-[9px] text-gray-500">–í–ø–µ—Ä–≤—ã–µ –ø–æ—Å–ª–µ 20 –Ω–µ–¥ (ISSHP, 2023)</span>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4 pb-24">
                        <h3 class="font-bold text-[#3B82F6] border-b-2 border-blue-100 pb-1 text-sm uppercase tracking-wider">–°–∫—Ä–∏–Ω–∏–Ω–≥ I —Ç—Ä–∏–º–µ—Å—Ç—Ä–∞ –∏ –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="block text-xs font-bold text-[#6B7280] mb-1">–†–∏—Å–∫ –ü–≠ (—Å–∫—Ä–∏–Ω–∏–Ω–≥)</label><input type="text" id="inp-scr-pe" placeholder="–ù–∞–ø—Ä. 1:150" class="block w-full rounded-lg border-gray-300 shadow-sm text-sm p-2"></div>
                            <div><label class="block text-xs font-bold text-[#6B7280] mb-1">–†–∏—Å–∫ –ó–†–ü (—Å–∫—Ä–∏–Ω–∏–Ω–≥)</label><input type="text" id="inp-scr-fgr" placeholder="–ù–∞–ø—Ä. 1:80" class="block w-full rounded-lg border-gray-300 shadow-sm text-sm p-2"></div>
                            <div class="col-span-2">
                                <label class="block text-xs font-bold text-[#6B7280] mb-1">–°—Ç–∞—Ç—É—Å –∫—É—Ä–µ–Ω–∏—è</label>
                                <select id="inp-smoking" class="block w-full rounded-lg border-gray-300 shadow-sm text-sm p-2"><option>–ö—É—Ä–∏—Ç</option><option>–ù–µ –∫—É—Ä–∏—Ç</option><option>–ë—Ä–æ—Å–∏–ª–∞</option></select>
                            </div>
                        </div>
                    </div>

                    <div class="pt-6 border-t sticky bottom-0 bg-white shadow-[0_-10px_15px_-3px_rgba(0,0,0,0.05)]">
                        <div class="mb-4">
                            <label class="block text-xs font-black text-[#111827] mb-2 uppercase text-[11px] tracking-tighter">–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏—Ö –ø–æ—Ä–æ–≥–æ–≤:</label>
                            <div class="grid grid-cols-2 gap-3">
                                <button type="button" id="mode-screening" class="py-2.5 px-2 text-[10px] font-black border rounded-lg uppercase transition active-mode leading-tight">–°–∫—Ä–∏–Ω–∏–Ω–≥–æ–≤—ã–π —Ä–µ–∂–∏–º<br><span class="font-medium normal-case text-[#6B7280]">–ñ–µ–Ω—Å–∫–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</span></button>
                                <button type="button" id="mode-tactical" class="py-2.5 px-2 text-[10px] font-black border border-gray-300 rounded-lg uppercase text-[#6B7280] transition hover:bg-gray-50 leading-tight">–¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º<br><span class="font-medium normal-case text-[#6B7280]">–ê–∫—É—à–µ—Ä—Å–∫–∏–π —Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä</span></button>
                            </div>
                        </div>
                        <button id="calc-trigger" type="button" class="w-full py-4 bg-[#3B82F6] text-white font-black rounded-xl shadow-lg hover:bg-[#2563EB] transition uppercase tracking-widest text-sm flex items-center justify-center gap-3">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h3m-3-10h.01M9 17h.01M12 17h.01M15 17h.01M9 14h.01M12 14h.01M15 14h.01M9 11h.01M12 11h.01M15 11h.01M12 4a1 1 0 011 1v1a1 1 0 01-2 0V5a1 1 0 011-1z"></path></svg>
                            –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫
                        </button>
                    </div>
                </form>
            </div>

            <div class="w-full md:w-7/12 p-6 bg-[#F9FAFB] overflow-y-auto" id="right-panel">
                
                <div id="results-empty" class="h-full flex flex-col items-center justify-center text-[#6B7280] text-center px-10">
                    <div class="bg-white p-10 rounded-3xl shadow-sm border border-gray-200">
                        <svg class="mx-auto w-20 h-20 mb-6 text-gray-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        
                        <p class="text-xl font-black text-[#111827] mb-3 uppercase tracking-wide">
                            –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–º—É –∞–Ω–∞–ª–∏–∑—É
                        </p>
                        
                        <p class="text-sm text-[#6B7280] max-w-md leading-relaxed mx-auto">
                            –ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö ML-–º–æ–¥–µ–ª–µ–π (RandomForest) —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∏—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Ä–∏—Å–∫–∞ —Å —É—á–µ—Ç–æ–º –Ω–µ–ª–∏–Ω–µ–π–Ω—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π –∏ —Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø–ª–∞–Ω –≤–µ–¥–µ–Ω–∏—è –ø–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –ú–ó –†–§.
                        </p>
                    </div>
                </div>

                <div id="results-container" class="hidden space-y-6">
                    <div id="results-content"></div>
                    
                    <div id="risk-factors-block"></div>

                    <div id="cards-wrapper" class="grid grid-cols-1 lg:grid-cols-2 gap-5"></div>
                    
                    <p class="text-[10px] text-gray-400 text-center italic mt-[-10px]">
                        * –ö–ª–∏–Ω–∏—á–µ—Å–∫–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω–æ–π (100%). –ó–Ω–∞—á–µ–Ω–∏–µ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ (BMJ, 2023).
                    </p>

                    <div id="recommendations-wrapper" class="hidden bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden fade-in"></div>

                    <div class="bg-[#DBEAFE] text-[#111827] p-6 rounded-2xl shadow-md border border-blue-200 space-y-4 fade-in">
                        <div class="flex items-center justify-between border-b border-blue-300 pb-3">
                            <div class="flex items-center gap-2">
                                <svg class="w-6 h-6 text-[#3B82F6]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <h4 class="font-bold text-sm uppercase tracking-wider text-[#3B82F6]">–ü—Ä–æ—Ç–æ–∫–æ–ª CDSS</h4>
                            </div>
                            <button onclick="openModal('modal-cdss-info')" class="text-[10px] text-[#3B82F6] hover:text-[#2563EB] underline underline-offset-4 font-black uppercase">–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Å–∏—Å—Ç–µ–º–µ CDSS ‚Üí</button>
                        </div>
                        <div id="cdss-generated-text" class="text-[12px] leading-relaxed whitespace-pre-wrap font-medium tracking-tight text-[#111827]"></div>
                        <div class="pt-2">
                            <button id="copy-to-comment" class="bg-[#3B82F6] hover:bg-[#2563EB] text-white text-[10px] font-black py-2 px-5 rounded-xl uppercase transition border border-blue-600 flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                –ü—Ä–∏–Ω—è—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–µ –º–Ω–µ–Ω–∏–µ CDSS (–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–Ω–∏–∑)
                            </button>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-md space-y-5 fade-in">
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-[#6B7280] uppercase">–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –∏ –æ—Å–æ–±—ã–µ –æ—Ç–º–µ—Ç–∫–∏:</label>
                            <textarea id="doctor-comment" class="w-full text-sm border-gray-200 rounded-xl focus:ring-blue-500 h-24 p-2" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —É–∫–∞–∑–∞–Ω–∏—è..."></textarea>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-2 pt-2">
                            <button id="btn-protocol" class="flex-1 bg-[#3B82F6] text-white font-black text-[11px] py-4 rounded-xl uppercase hover:bg-[#2563EB] transition shadow-lg flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                –í—ã–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª CDSS (TXT)
                            </button>
                            <button id="btn-export" class="flex-1 btn-disabled-look text-[11px] font-black py-4 rounded-xl uppercase transition flex items-center justify-center gap-2" onclick="alert('–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ –≠–ú–ö –ú–ò–° –≤ —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏'); return false;">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                                –≠–∫—Å–ø–æ—Ä—Ç –≤ –≠–ú–ö –ú–ò–°
                            </button>
                        </div>
                        <p class="text-[10px] text-gray-400 text-center border-t pt-2">
                            –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –Ω–æ—Å—è—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –Ω–µ –∑–∞–º–µ–Ω—è—é—Ç –æ—á–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –≤—Ä–∞—á–∞-–∞–∫—É—à–µ—Ä–∞-–≥–∏–Ω–µ–∫–æ–ª–æ–≥–∞ (–ü—Ä–∏–∫–∞–∑ –ú–ó –†–§ ‚Ññ 911–Ω).
                        </p>
                    </div>
                </div>

            </div>
        </main>
        
        <footer class="mt-4 text-center text-[10px] text-gray-400 border-t border-gray-200 pt-4 flex-shrink-0">
            ¬© 2025 | –ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∏—Å–∫–æ–≤ –≤ –∞–∫—É—à–µ—Ä—Å—Ç–≤–µ | –†–∞–∑–º–µ—â—ë–Ω –≤ Yandex Cloud | –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥: <a href="https://github.com/ayzavyalov-blip/risk-calc" target="_blank" class="underline hover:text-blue-500">GitHub</a>
        </footer>
    </div>

    <div id="modal-cdss-info" class="modal">
        <div class="modal-content">
            <h2 class="text-xl font-bold text-[#111827] mb-4 uppercase">–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏–Ω—è—Ç–∏—è –≤—Ä–∞—á–µ–±–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π (CDSS)</h2>
            <div class="space-y-4 text-sm leading-relaxed text-[#374151]">
                <p><strong>Clinical Decision Support System (CDSS)</strong> ‚Äî —ç—Ç–æ —Ü–∏—Ñ—Ä–æ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É—é—â–∞—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –ø–∞—Ü–∏–µ–Ω—Ç–µ –¥–ª—è –ø–æ–º–æ—â–∏ –≤—Ä–∞—á—É –≤ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π.</p>
                <p>–î–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–Ω—Å–∞–º–±–ª–µ–≤—ã–µ ML-–º–æ–¥–µ–ª–∏ (RandomForest), –æ–±—É—á–µ–Ω–Ω—ã–µ –Ω–∞ –∫–æ–≥–æ—Ä—Ç–µ –±–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∏—Å–∫–∞. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö —à–∫–∞–ª, CDSS –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –Ω–µ–ª–∏–Ω–µ–π–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Ñ–∞–∫—Ç–æ—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ—á–µ—Ç–∞–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–∞, –∫—É—Ä–µ–Ω–∏—è –∏ –Ω—É—Ç—Ä–∏—Ç–∏–≤–Ω–æ–≥–æ –¥–µ—Ñ–∏—Ü–∏—Ç–∞).</p>
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <p class="font-bold mb-2 text-[#111827]">–ó–∞–¥–∞—á–∏ —Å–∏—Å—Ç–µ–º—ã –≤ –ø—Ä–∞–∫—Ç–∏–∫–µ –∞–∫—É—à–µ—Ä–∞-–≥–∏–Ω–µ–∫–æ–ª–æ–≥–∞:</p>
                    <ul class="list-disc pl-5 space-y-1 text-[#4B5563]">
                        <li><strong>–û–±—ä–µ–∫—Ç–∏–≤–∏–∑–∞—Ü–∏—è:</strong> –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ü–≠ –∏ –ó–†–ü.</li>
                        <li><strong>–†–∞–Ω–Ω–µ–µ –≤—ã—è–≤–ª–µ–Ω–∏–µ:</strong> –°—Ç—Ä–∞—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∏—Å–∫–∞ —É–∂–µ –≤ I —Ç—Ä–∏–º–µ—Å—Ç—Ä–µ.</li>
                        <li><strong>–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏:</strong> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–±–æ—Ä –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤, –Ω—É–∂–¥–∞—é—â–∏—Ö—Å—è –≤ —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–º –£–ó–ò.</li>
                        <li><strong>–î–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> –ü—Ä—è–º–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç–∞–∫—Ç–∏–∫–∏ —Å –ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ú–ó –†–§.</li>
                    </ul>
                </div>
                <p class="italic text-xs text-gray-400 text-center">–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –Ω–∞ –±–∞–∑–µ –ì–ö–ë –∏–º. –ú.–ê. –¢–≤–µ—Ä—å–µ (2024-2025). –ê–≤—Ç–æ—Ä—ã: –ó–∞–≤—å—è–ª–æ–≤–∞ –Æ.–ê., –û–ª–∏–Ω–∞ –ê.–ê. –∏ —Å–æ–∞–≤—Ç.</p>
            </div>
            <button onclick="closeModal('modal-cdss-info')" class="mt-6 w-full py-3 bg-[#1F2937] text-white rounded-lg font-bold uppercase text-xs hover:bg-black transition">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É</button>
        </div>
    </div>

    <div id="modal-pe-info" class="modal">
        <div class="modal-content">
            <h2 class="text-xl font-bold text-[#111827] mb-4 uppercase">–ù–∞—É—á–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –ü–≠</h2>
            <div class="space-y-4 text-sm leading-relaxed text-[#374151]">
                <p><strong>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏:</strong> –ó–∞–≤—å—è–ª–æ–≤–∞ –Æ.–ê., –û–ª–∏–Ω–∞ –ê.–ê. –∏ —Å–æ–∞–≤—Ç–æ—Ä—ã.</p>
                <p><strong>–ê–ª–≥–æ—Ä–∏—Ç–º:</strong> –ê–Ω—Å–∞–º–±–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å ¬´–°–ª—É—á–∞–π–Ω—ã–π –ª–µ—Å¬ª (RandomForestClassifier). –î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ <strong>–∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –º–µ—Ç–æ–¥–æ–º –ü–ª–∞—Ç—Ç–∞ (Platt scaling)</strong> —á–µ—Ä–µ–∑ CalibratedClassifierCV.</p>
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                    <p class="font-bold text-blue-900 mb-2 uppercase text-[10px]">–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (Bootstrap-–≤–∞–ª–∏–¥–∞—Ü–∏—è n=1000):</p>
                    <ul class="list-disc pl-5 space-y-1 text-blue-800">
                        <li><strong>ROC-AUC: 0.842</strong> ([0.797; 0.883]) - –æ—Ç–ª–∏—á–Ω–∞—è –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∏—Ä—É—é—â–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å.</li>
                        <li><strong>–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 0.867</strong> (–ø—Ä–∏ —Å–∫—Ä–∏–Ω–∏–Ω–≥–æ–≤–æ–º –ø–æ—Ä–æ–≥–µ 0.57) - –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ª–æ–∂–Ω–æ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.</li>
                        <li><strong>–°–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ—Å—Ç—å: 0.550</strong></li>
                        <li><strong>PR-AUC: 0.919</strong> - –≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤.</li>
                    </ul>
                </div>
                <p><strong>–ö–ª–∏–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–ª—å–∑–∞:</strong> –ê–Ω–∞–ª–∏–∑ –∫—Ä–∏–≤—ã—Ö –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π (Decision Curve Analysis) –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–æ –º–æ–¥–µ–ª–∏ –Ω–∞–¥ —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π ¬´–ª–µ—á–∏—Ç—å –≤—Å–µ—Ö¬ª –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –ø–æ—Ä–æ–≥–æ–≤ —Ä–∏—Å–∫–∞ 0,1‚Äì0,5. –ú–æ–¥–µ–ª—å —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Ñ–∞–∫—Ç–æ—Ä–æ–≤: –≤–æ–∑—Ä–∞—Å—Ç, –ò–ú–¢, –ø–∞—Ä–∏—Ç–µ—Ç –∏ –∞–Ω–∞–º–Ω–µ–∑.</p>
            </div>
            <button onclick="closeModal('modal-pe-info')" class="mt-6 w-full py-3 bg-[#1F2937] text-white rounded-lg font-bold uppercase text-xs hover:bg-black transition">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div id="modal-fgr-info" class="modal">
        <div class="modal-content">
            <h2 class="text-xl font-bold text-[#111827] mb-4 uppercase">–ù–∞—É—á–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –ó–†–ü</h2>
            <div class="space-y-4 text-sm leading-relaxed text-[#374151]">
                <p><strong>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏:</strong> –ó–∞–≤—å—è–ª–æ–≤–∞ –Æ.–ê., –û–ª–∏–Ω–∞ –ê.–ê. –∏ —Å–æ–∞–≤—Ç–æ—Ä—ã.</p>
                <p><strong>–ê–ª–≥–æ—Ä–∏—Ç–º:</strong> RandomForestClassifier —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–µ—Å–æ–≤ –∫–ª–∞—Å—Å–æ–≤ (class_weight='balanced') –¥–ª—è —É—á–µ—Ç–∞ –Ω–µ–≤—ã—Å–æ–∫–æ–π —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω–æ—Å—Ç–∏ –∏—Å—Ö–æ–¥–∞ (5-10% –≤ –ø–æ–ø—É–ª—è—Ü–∏–∏). –ì–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ GridSearch.</p>
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                    <p class="font-bold text-blue-900 mb-2 uppercase text-[10px]">–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (Bootstrap-–≤–∞–ª–∏–¥–∞—Ü–∏—è n=1000):</p>
                    <ul class="list-disc pl-5 space-y-1 text-blue-800">
                        <li><strong>ROC-AUC: 0.884</strong> ([0.848; 0.918]) - –≤—ã—Å–æ–∫–∞—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å.</li>
                        <li><strong>–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 0.851</strong> (—Å–∫—Ä–∏–Ω–∏–Ω–≥–æ–≤—ã–π –ø–æ—Ä–æ–≥ 0.39) - –≤—ã—è–≤–ª–µ–Ω–∏–µ 8.5 –∏–∑ 10 —Å–ª—É—á–∞–µ–≤ –ó–†–ü.</li>
                        <li><strong>–°–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ—Å—Ç—å: 0.738</strong></li>
                    </ul>
                </div>
                <p><strong>–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:</strong> –ú–æ–¥–µ–ª—å —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –Ω–µ–ª–∏–Ω–µ–π–Ω—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è—Ö –º–µ–∂–¥—É –∫—É—Ä–µ–Ω–∏–µ–º, –Ω—É—Ç—Ä–∏—Ç–∏–≤–Ω–æ–π –ø—Ä–∏–±–∞–≤–∫–æ–π –≤–µ—Å–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω—ã–º —Ä–∏—Å–∫–æ–º I —Å–∫—Ä–∏–Ω–∏–Ω–≥–∞. –û—Ç–¥–µ–ª—å–Ω–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–Ω–∞–º–Ω–µ–∑ –ó–†–ü, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–≤—ã—à–∞–µ—Ç —Ä–∏—Å–∫ (OR 2.2).</p>
            </div>
            <button onclick="closeModal('modal-fgr-info')" class="mt-6 w-full py-3 bg-[#1F2937] text-white rounded-lg font-bold uppercase text-xs hover:bg-black transition">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

   <script>
        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø API –ò –ú–û–î–ï–õ–ï–ô ===
        const API_URL = "https://bbao7sb3qb98qg2cso0r.containers.yandexcloud.net/predict";

        const MODELS_CONFIG = [
            {
                id: 'pe',
                title: '–ü—Ä–µ—ç–∫–ª–∞–º–ø—Å–∏—è (–ü–≠)',
                crRef: '–ö–† –ú–ó –†–§ ¬´–ü—Ä–µ—ç–∫–ª–∞–º–ø—Å–∏—è...¬ª (2021)',
                threshold: 0.57, 
                thresholdSevere: 0.80,
                baseRef: '–†–∞–∑–¥–µ–ª 5 ¬´–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞¬ª, –†–∞–∑–¥–µ–ª 3 ¬´–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞¬ª.',
                checkList: [
                    {text: '–ù–∞–∑–Ω–∞—á–∏—Ç—å –∞—Ü–µ—Ç–∏–ª—Å–∞–ª–∏—Ü–∏–ª–æ–≤—É—é –∫–∏—Å–ª–æ—Ç—É 150 –º–≥ –Ω–∞ –Ω–æ—á—å (–¥–æ 36 –Ω–µ–¥.)', category: '–ú–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–∑–Ω–∞—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞', requiredLevel: 'high'},
                    {text: '–ü—Ä–µ–ø–∞—Ä–∞—Ç—ã –∫–∞–ª—å—Ü–∏—è 1–≥/—Å—É—Ç (–ø—Ä–∏ –Ω–∏–∑–∫–æ–º –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏)', category: '–ú–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–∑–Ω–∞—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞', requiredLevel: 'high'},
                    {text: '–ö–æ–Ω—Ç—Ä–æ–ª—å –ê–î (2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å) + –≤–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞', category: '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥', requiredLevel: 'high'},
                    {text: '–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–µ–ª–∫–∞ –≤ –º–æ—á–µ (—Ç–µ—Å—Ç-–ø–æ–ª–æ—Å–∫–∏) –ø—Ä–∏ –∫–∞–∂–¥–æ–π —è–≤–∫–µ', category: '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥', requiredLevel: 'high'},
                    {text: '–ì–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä III —É—Ä–æ–≤–Ω—è', category: '–¢–∞–∫—Ç–∏–∫–∞ –ø—Ä–∏ —Ç—è–∂–µ–ª—ã—Ö –æ—Å–ª–æ–∂–Ω–µ–Ω–∏—è—Ö', requiredLevel: 'severe'},
                    {text: '–î–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–æ–¥–æ—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ (–ø–æ –ø–æ–∫–∞–∑–∞–Ω–∏—è–º)', category: '–¢–∞–∫—Ç–∏–∫–∞ –ø—Ä–∏ —Ç—è–∂–µ–ª—ã—Ö –æ—Å–ª–æ–∂–Ω–µ–Ω–∏—è—Ö', requiredLevel: 'severe'}
                ]
            },
            {
                id: 'fgr',
                title: '–ó–∞–¥–µ—Ä–∂–∫–∞ —Ä–æ—Å—Ç–∞ –ø–ª–æ–¥–∞ (–ó–†–ü)',
                crRef: '–ö–† –ú–ó –†–§ ¬´–ó–∞–¥–µ—Ä–∂–∫–∞ —Ä–æ—Å—Ç–∞ –ø–ª–æ–¥–∞¬ª (2024)',
                threshold: 0.39,
                thresholdSevere: 0.70,
                baseRef: '–†–∞–∑–¥–µ–ª 2.4 ¬´–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è¬ª.',
                checkList: [
                    {text: '–≠–∫—Å–ø–µ—Ä—Ç–Ω–∞—è –£–ó-–¥–æ–ø–ø–ª–µ—Ä–æ–º–µ—Ç—Ä–∏—è (–ú–ê, –ê–ü)', category: '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞', requiredLevel: 'high'},
                    {text: '–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –£–ó-—Ñ–µ—Ç–æ–º–µ—Ç—Ä–∏—è (–∏–Ω—Ç–µ—Ä–≤–∞–ª 14-21 –¥–µ–Ω—å)', category: '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞', requiredLevel: 'high'},
                    {text: '–ö–¢–ì —Å 26 –Ω–µ–¥–µ–ª—å (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ; –ø—Ä–∏ –ó–†–ü - 2 —Ä–∞–∑–∞/–Ω–µ–¥)', category: '–û—Ü–µ–Ω–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–ª–æ–¥–∞ (FIGO 2023)', requiredLevel: 'high'},
                    {text: '–ì–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è (–ø—Ä–∏ –Ω—É–ª–µ–≤–æ–º/—Ä–µ–≤–µ—Ä—Å–Ω–æ–º –∫—Ä–æ–≤–æ—Ç–æ–∫–µ)', category: '–≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è —Ç–∞–∫—Ç–∏–∫–∞', requiredLevel: 'severe'}
                ]
            }
        ];

        // –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –±–ª–æ–∫–∞ "–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥—Ä–∞–π–≤–µ—Ä—ã —Ä–∏—Å–∫–∞"
        // –ü–†–ê–í–ö–ê: –ï—Å–ª–∏ –ò–ú–¢ –Ω–µ –∏–∑–≤–µ—Å—Ç–µ–Ω (—Ç.–µ. –º—ã –µ–≥–æ –Ω–µ —Å—á–∏—Ç–∞–µ–º), –ø—Ä–∞–≤–∏–ª–æ obesity –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç
        const RISK_FACTORS_RULES = [
            { id: 'obesity', label: '–ò–Ω–¥–µ–∫—Å –º–∞—Å—Å—ã —Ç–µ–ª–∞ (–û–∂–∏—Ä–µ–Ω–∏–µ)', or: 3.5, check: (i) => i.weightKnown && i.bmi >= 30 },
            { id: 'hag', label: '–ù–∞–ª–∏—á–∏–µ —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–æ–π –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–π –≥–∏–ø–µ—Ä—Ç–µ–Ω–∑–∏–∏', or: 2.8, check: (i) => i.hag == '–î–∞' },
            { id: 'pe_hist', label: '–ü—Ä–µ—ç–∫–ª–∞–º–ø—Å–∏—è –≤ –∞–Ω–∞–º–Ω–µ–∑–µ', or: 4.1, check: (i) => i.pe_hist == '–î–∞' },
            { id: 'age', label: '–í–æ–∑—Ä–∞—Å—Ç–Ω–æ–π —Ñ–∞–∫—Ç–æ—Ä (35+)', or: 1.5, check: (i) => i.age >= 35 },
            { id: 'fgr_hist', label: '–ó–†–ü –≤ –∞–Ω–∞–º–Ω–µ–∑–µ', or: 2.2, check: (i) => i.fgr_hist == '–î–∞' },
            { id: 'smoking_def', label: '–§–µ–Ω–æ—Ç–∏–ø: –ö—É—Ä–µ–Ω–∏–µ + –î–µ—Ñ–∏—Ü–∏—Ç –≤–µ—Å–∞', or: 3.8, check: (i) => i.weightKnown && i.smoking == '–ö—É—Ä–∏—Ç' && i.bmi < 18.5 },
            { id: 'kidney', label: '–ë–æ–ª–µ–∑–Ω–∏ –ø–æ—á–µ–∫', or: 2.5, check: (i) => i.kidney == '–î–∞' }
        ];

        function openModal(id) { document.getElementById(id).style.display = "block"; }
        function closeModal(id) { document.getElementById(id).style.display = "none"; }
        window.onclick = function(event) { if (event.target.className === 'modal') { event.target.style.display = "none"; } }

        function renderRiskFactorsBlock(inputs) {
            const activeFactors = RISK_FACTORS_RULES.filter(rule => rule.check(inputs));
            if (activeFactors.length === 0) return ''; 
            activeFactors.sort((a, b) => b.or - a.or);
            const barsHTML = activeFactors.map(f => {
                const width = Math.min((f.or / 5) * 100, 100); 
                return `
                    <div class="space-y-1">
                        <div class="flex justify-between text-[11px] mb-1">
                            <span>${f.label}</span>
                            <span class="text-white font-bold opacity-90">OR: ${f.or}</span>
                        </div>
                        <div class="h-2.5 bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full bg-[#EF4444] border-r border-white/20" style="width: ${width}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
            
            return `
                <div class="bg-[#1F2937] text-white p-6 rounded-2xl shadow-xl border border-gray-700 fade-in">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-base font-bold flex items-center uppercase tracking-tight text-white">
                            –í–µ–¥—É—â–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞ (–û—Ç–Ω–æ—à–µ–Ω–∏–µ —à–∞–Ω—Å–æ–≤)
                        </h3>
                    </div>
                    <div class="space-y-4 text-white">${barsHTML}</div>
                </div>
            `;
        }

        function renderResults(apiData, userInputs) {
            const container = document.getElementById('cards-wrapper');
            const factorsContainer = document.getElementById('risk-factors-block');
            const recWrapper = document.getElementById('recommendations-wrapper');
            
            container.innerHTML = '';
            factorsContainer.innerHTML = renderRiskFactorsBlock(userInputs);

            let hasAnyHighRisk = false;
            let combinedRecsHTML = '';
            
            // –õ–æ–≥–∏–∫–∞ –±–µ–ª–∫–æ–≤–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è: –ï—Å–ª–∏ —Ä–∏—Å–∫ –ü–≠/–ó–†–ü –≤—ã—Å–æ–∫–∏–π –ò–õ–ò –¥–µ—Ñ–∏—Ü–∏—Ç –º–∞—Å—Å—ã
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∏—Å–∫–∏ –Ω–∏–∂–µ, –∞ –ò–ú–¢ –∑–¥–µ—Å—å
            const isLowBmi = userInputs.weightKnown && (parseFloat(userInputs.bmi) < 18.5);
            let needsProtein = isLowBmi; 

            MODELS_CONFIG.forEach(model => {
                let prob = apiData[`${model.id}_risk`];
                if (prob > 0.99) prob = 0.99;
                
                const percent = (prob * 100).toFixed(1) + '%';
                const isHigh = prob >= model.threshold;
                const isSevere = prob >= model.thresholdSevere;
                const severityLabel = model.id === 'pe' ? '–ü–≠' : '–ó–†–ü';
                
                if (isHigh) needsProtein = true; // –ï—Å–ª–∏ –µ—Å—Ç—å –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ - –Ω—É–∂–Ω–æ –ø–∏—Ç–∞–Ω–∏–µ

                const bgColor = isHigh ? 'bg-[#FEF2F2]' : 'bg-[#ECFDF5]';
                const borderColor = isHigh ? 'border-[#EF4444]' : 'border-[#10B981]';
                const textColor = isHigh ? 'text-[#EF4444]' : 'text-[#10B981]';
                const badgeText = isHigh ? '–í–´–°–û–ö–ò–ô –†–ò–°–ö' : '–ù–ò–ó–ö–ò–ô –†–ò–°–ö';
                const icon = isHigh ? '‚ö†Ô∏è' : 'üõ°Ô∏è';

                const cardHtml = `
                    <div class="${bgColor} border-2 ${borderColor} p-6 rounded-xl shadow-sm hover:shadow-md transition flex flex-col fade-in">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-[#111827] uppercase text-xs tracking-wider">${model.title}</h4>
                            <div class="flex flex-col items-end gap-1 text-right">
                                <span class="font-bold text-[10px] uppercase flex items-center gap-1 ${textColor}">
                                    ${icon} ${badgeText}
                                </span>
                                ${isSevere ? `<span class="bg-[#EF4444] text-white text-[9px] font-black px-2 py-0.5 rounded-full uppercase animate-pulse">–†–∏—Å–∫ —Ç—è–∂–µ–ª–æ–π ${severityLabel}</span>` : ''}
                            </div>
                        </div>
                        <div class="text-[36px] font-bold ${textColor} mb-2 leading-none">${percent}</div>
                        <div class="p-3 bg-white/60 border border-gray-200/50 rounded-lg text-[10px] text-[#4B5563] mb-4 leading-tight flex-1">
                            <strong>–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:</strong> ${model.baseRef}
                        </div>
                        <button onclick="openModal('modal-${model.id}-info')" class="text-[10px] font-bold text-[#3B82F6] uppercase hover:underline text-left">–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –º–æ–¥–µ–ª–∏ ${model.id === 'pe' ? '–ü–≠' : '–ó–†–ü'} ‚Üí</button>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', cardHtml);

                if (isHigh) {
                    hasAnyHighRisk = true;
                    const grouped = {};
                    model.checkList.forEach(item => {
                        if (!grouped[item.category]) grouped[item.category] = [];
                        grouped[item.category].push(item);
                    });

                    let groupHTML = '';
                    for (const [category, items] of Object.entries(grouped)) {
                        const itemsHTML = items.map(item => {
                            const isChecked = (item.requiredLevel === 'high') || (item.requiredLevel === 'severe' && isSevere);
                            const opacityClass = isChecked ? '' : 'opacity-50 grayscale';
                            return `
                                <label class="flex items-start p-2 hover:bg-gray-50 rounded cursor-pointer transition ${opacityClass}">
                                    <input type="checkbox" ${isChecked ? 'checked' : ''} class="mt-1 w-4 h-4 text-[#3B82F6] rounded mr-3 border-gray-300 focus:ring-blue-500">
                                    <span class="text-[11px] leading-tight text-[#374151] font-medium">${item.text}</span>
                                </label>
                            `;
                        }).join('');

                        groupHTML += `
                            <div class="mb-4 last:mb-0">
                                <h6 class="text-[10px] font-bold text-[#9CA3AF] uppercase tracking-wider mb-2 pl-2 border-l-2 border-gray-200">${category}</h6>
                                <div class="space-y-1">${itemsHTML}</div>
                            </div>
                        `;
                    }

                    combinedRecsHTML += `
                        <div class="bg-white p-5 border-b last:border-b-0 border-gray-100">
                             <div class="flex items-center gap-2 mb-4">
                                <span class="bg-blue-50 text-[#3B82F6] text-[9px] font-black px-2 py-0.5 rounded">–ö–† –ú–ó –†–§</span>
                                <h5 class="text-xs font-bold text-[#1F2937] leading-tight hover:text-[#3B82F6] cursor-pointer transition" title="–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Ç–µ–∫—Å—Ç –ö–†">${model.crRef}</h5>
                             </div>
                             ${groupHTML}
                        </div>
                    `;
                }
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –≥–∞–ª–æ—á–∫—É –ø—Ä–æ –ü–∏—Ç–∞–Ω–∏–µ –≤ –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if (needsProtein) {
                 combinedRecsHTML += `
                    <div class="bg-white p-5 border-b last:border-b-0 border-gray-100 col-span-1 md:col-span-2">
                         <div class="flex items-center gap-2 mb-2">
                             <span class="bg-green-50 text-green-600 text-[9px] font-black px-2 py-0.5 rounded">–ù–£–¢–†–ò–¶–ò–û–õ–û–ì–ò–Ø</span>
                             <h5 class="text-xs font-bold text-[#1F2937]">–î–∏–µ—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è</h5>
                         </div>
                         <label class="flex items-start p-2 hover:bg-gray-50 rounded cursor-pointer transition">
                             <input type="checkbox" id="chk-protein-rec" checked class="mt-1 w-4 h-4 text-[#3B82F6] rounded mr-3 border-gray-300 focus:ring-blue-500">
                             <span class="text-[11px] leading-tight text-[#374151] font-medium">–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–∏–µ—Ç—ã (–±–µ–ª–∫–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ ‚â•70‚Äì90 –≥/—Å—É—Ç)</span>
                         </label>
                    </div>
                `;
            }

            if (hasAnyHighRisk || needsProtein) {
                recWrapper.innerHTML = `
                    <div class="p-5 bg-gray-50 border-b border-gray-200 flex items-center gap-2">
                        <svg class="w-5 h-5 text-[#3B82F6]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>
                        <h4 class="font-black text-sm uppercase text-[#1F2937] tracking-tight">–ó–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∏ —Ç–∞–∫—Ç–∏–∫–∞</h4>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-gray-100">
                        ${combinedRecsHTML}
                    </div>
                `;
                recWrapper.classList.remove('hidden');
            } else {
                recWrapper.classList.add('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // === –õ–û–ì–ò–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê ===
            const inpParity = document.getElementById('inp-parity');
            const inpInterval = document.getElementById('inp-interval');
            const inpWeightKnown = document.getElementById('inp-weight-known');
            const weightFields = document.getElementById('weight-fields');
            const inpWeeks = document.getElementById('header-weeks');
            const inpGag = document.getElementById('inp-gag');
            const gagLabel = document.getElementById('gag-label');
            const gagContainer = document.getElementById('gag-container');

            // 1. –ò–Ω—Ç–µ—Ä–≤–∞–ª (–ü—Ä–æ—á–µ—Ä–∫ –ø—Ä–∏ –ø–µ—Ä–≤—ã—Ö —Ä–æ–¥–∞—Ö)
            inpParity.addEventListener('input', () => {
                if (parseInt(inpParity.value) === 0) {
                    inpInterval.value = 'none';
                    inpInterval.disabled = true;
                } else {
                    inpInterval.disabled = false;
                    if (inpInterval.value === 'none') inpInterval.value = 'norm';
                }
            });

            // 2. –í–µ—Å (–°–∫—Ä—ã—Ç–∏–µ –ø–æ–ª–µ–π)
            inpWeightKnown.addEventListener('change', () => {
                if (inpWeightKnown.checked) {
                    weightFields.classList.remove('opacity-50', 'pointer-events-none');
                } else {
                    weightFields.classList.add('opacity-50', 'pointer-events-none');
                    document.getElementById('inp-gain').value = '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–æ—Ä–º–µ'; 
                }
            });

            // 3. –ì–ê–ì (–ê–∫—Ç–∏–≤–Ω–æ —Ç–æ–ª—å–∫–æ >= 20 –Ω–µ–¥–µ–ª—å)
            const updateGagState = () => {
                if (inpWeeks.selectedIndex >= 5) {
                    inpGag.disabled = false;
                    gagContainer.classList.remove('opacity-50', 'cursor-not-allowed');
                    gagLabel.classList.remove('text-gray-400');
                    gagLabel.classList.add('text-[#111827]');
                } else {
                    inpGag.disabled = true;
                    inpGag.checked = false;
                    gagContainer.classList.add('opacity-50', 'cursor-not-allowed');
                    gagLabel.classList.remove('text-[#111827]');
                    gagLabel.classList.add('text-gray-400');
                }
            };
            inpWeeks.addEventListener('change', updateGagState);
            updateGagState();

            const trigger = document.getElementById('calc-trigger');
            const resultsContent = document.getElementById('results-content');
            const emptyState = document.getElementById('results-empty');
            const cdssOutput = document.getElementById('cdss-generated-text');
            const doctorComment = document.getElementById('doctor-comment');
            
            trigger.addEventListener('click', async () => {
                // –í–ê–õ–ò–î–ê–¶–ò–Ø –í–û–ó–†–ê–°–¢–ê
                const ageVal = parseInt(document.getElementById('inp-age').value);
                if (ageVal < 15 || ageVal > 50) {
                    document.getElementById('age-error').classList.remove('hidden');
                    alert('–í–æ–∑—Ä–∞—Å—Ç –ø–∞—Ü–∏–µ–Ω—Ç–∫–∏ –≤–Ω–µ —Ä–µ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (15-50 –ª–µ—Ç). –†–∞—Å—á–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.');
                    return;
                } else {
                    document.getElementById('age-error').classList.add('hidden');
                }

                const originalText = trigger.innerHTML;
                trigger.innerHTML = '<span class="animate-pulse tracking-widest uppercase">–ò–¥–µ—Ç —Ä–∞—Å—á–µ—Ç...</span>';
                trigger.disabled = true;

                // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                const isWeightKnown = document.getElementById('inp-weight-known').checked;
                const bmiVal = isWeightKnown ? document.getElementById('inp-bmi').value : "22.0"; // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ—Ä–º—É, –µ—Å–ª–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω, —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å –Ω–µ —Å–ª–æ–º–∞–ª–∞—Å—å

                const inputs = {
                    age: document.getElementById('inp-age').value,
                    parity: document.getElementById('inp-parity').value,
                    interval: document.getElementById('inp-interval').value,
                    pe_hist: document.getElementById('inp-pe-hist').value,
                    fgr_hist: document.getElementById('inp-fgr-hist').value,
                    hag: document.getElementById('inp-hag').value,
                    kidney: document.getElementById('inp-kidney').value,
                    bmi: bmiVal, 
                    weightKnown: isWeightKnown, // —Ñ–ª–∞–≥ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞
                    gain: document.getElementById('inp-gain').value,
                    smoking: document.getElementById('inp-smoking').value,
                    scr_pe: document.getElementById('inp-scr-pe').value,
                    scr_fgr: document.getElementById('inp-scr-fgr').value,
                    gag: document.getElementById('inp-gag').checked
                };

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(inputs)
                    });

                    if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                    const data = await response.json();

                    emptyState.classList.add('hidden');
                    document.getElementById('results-container').classList.remove('hidden');
                    renderResults(data, inputs);

                    // === –ì–ï–ù–ï–†–ê–¶–ò–Ø –ü–û–î–†–û–ë–ù–û–ì–û –ú–ï–î–ò–¶–ò–ù–°–ö–û–ì–û –ü–†–û–¢–û–ö–û–õ–ê ===
                    
                    const pName = document.getElementById('header-name').value;
                    const wSelect = document.getElementById('header-weeks');
                    const pWeeks = wSelect.options[wSelect.selectedIndex].text;
                    const pDoctor = document.getElementById('header-doctor').value;
                    const pId = document.getElementById('header-id').value;
                    const currentDate = new Date().toLocaleDateString('ru-RU');
                    
                    let probPE = data.pe_risk; if(probPE > 0.99) probPE = 0.99;
                    let probFGR = data.fgr_risk; if(probFGR > 0.99) probFGR = 0.99;
                    
                    const pePercent = (probPE * 100).toFixed(1);
                    const fgrPercent = (probFGR * 100).toFixed(1);

                    // 1. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–∞–≥–Ω–æ–∑–∞ –∏ —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π (–ú–ö–ë-10)
                    let diagnosisText = `–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å ${pWeeks}.`;
                    let comorbidities = [];
                    
                    if (inputs.hag === '–î–∞') comorbidities.push("–•—Ä–æ–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –≥–∏–ø–µ—Ä—Ç–µ–Ω–∑–∏—è (O10.0)");
                    if (inputs.gag) comorbidities.push("–ì–µ—Å—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –≥–∏–ø–µ—Ä—Ç–µ–Ω–∑–∏—è (O13)"); 
                    if (inputs.kidney === '–î–∞') comorbidities.push("–ë–æ–ª–µ–∑–Ω–∏ –ø–æ—á–µ–∫ (O10.2 / N00-N29)");
                    
                    if (isWeightKnown) {
                        if (parseFloat(inputs.bmi) >= 30) comorbidities.push(`–û–∂–∏—Ä–µ–Ω–∏–µ (–ò–ú–¢ ${inputs.bmi}) (E66.0)`);
                        else if (parseFloat(inputs.bmi) < 18.5) comorbidities.push(`–î–µ—Ñ–∏—Ü–∏—Ç –º–∞—Å—Å—ã —Ç–µ–ª–∞ (–ò–ú–¢ ${inputs.bmi}) (E46)`);
                    }

                    if (inputs.pe_hist === '–î–∞') comorbidities.push("–û—Ç—è–≥–æ—â–µ–Ω–Ω—ã–π –∞–∫—É—à–µ—Ä—Å–∫–∏–π –∞–Ω–∞–º–Ω–µ–∑: –ü–≠ –≤ –ø—Ä–æ—à–ª–æ–º (O09.2)");
                    if (inputs.fgr_hist === '–î–∞') comorbidities.push("–û—Ç—è–≥–æ—â–µ–Ω–Ω—ã–π –∞–∫—É—à–µ—Ä—Å–∫–∏–π –∞–Ω–∞–º–Ω–µ–∑: –ó–†–ü –≤ –ø—Ä–æ—à–ª–æ–º (O09.5)");
                    if (inputs.smoking === '–ö—É—Ä–∏—Ç') comorbidities.push("–¢–∞–±–∞–∫–æ–∫—É—Ä–µ–Ω–∏–µ (F17.2)");

                    const comorbText = comorbidities.length > 0 ? `\n–°–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–µ: ${comorbidities.join(', ')}.` : "";

                    // 2. –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞
                    const isHighRiskPE = probPE > 0.57;
                    const isHighRiskFGR = probFGR > 0.39;
                    
                    let riskConclusion = "";
                    if (isHighRiskPE && isHighRiskFGR) riskConclusion = "–í–´–°–û–ö–ò–ô –†–ò–°–ö –ü–†–ï–≠–ö–õ–ê–ú–ü–°–ò–ò –ò –ó–ê–î–ï–†–ñ–ö–ò –†–û–°–¢–ê –ü–õ–û–î–ê.";
                    else if (isHighRiskPE) riskConclusion = "–í–´–°–û–ö–ò–ô –†–ò–°–ö –ü–†–ï–≠–ö–õ–ê–ú–ü–°–ò–ò.";
                    else if (isHighRiskFGR) riskConclusion = "–í–´–°–û–ö–ò–ô –†–ò–°–ö –ó–ê–î–ï–†–ñ–ö–ò –†–û–°–¢–ê –ü–õ–û–î–ê.";
                    else riskConclusion = "–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ –±–æ–ª—å—à–∏—Ö –∞–∫—É—à–µ—Ä—Å–∫–∏—Ö —Å–∏–Ω–¥—Ä–æ–º–æ–≤.";
                    
                    const bmiText = isWeightKnown ? inputs.bmi : "–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω";

                    // 3. –ü–ª–∞–Ω –≤–µ–¥–µ–Ω–∏—è
                    let plan = [];
                    plan.push(`1. –î–∏—Å–ø–∞–Ω—Å–µ—Ä–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ: ${isHighRiskPE || isHighRiskFGR ? '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ (—è–≤–∫–∞ –∫–∞–∂–¥—ã–µ 2 –Ω–µ–¥–µ–ª–∏)' : '–°–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∏–∫–∞–∑—É 1130–Ω'}.`);
                    
                    if (isHighRiskPE) {
                        plan.push(`2. –ü–†–û–§–ò–õ–ê–ö–¢–ò–ö–ê –ü–≠ (–ö–† 2021):`);
                        plan.push(`   - –ê—Ü–µ—Ç–∏–ª—Å–∞–ª–∏—Ü–∏–ª–æ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞ 150 –º–≥ –Ω–∞ –Ω–æ—á—å (–¥–æ 36 –Ω–µ–¥).`);
                        plan.push(`   - –ö–æ–Ω—Ç—Ä–æ–ª—å –ê–î 2 —Ä–∞–∑–∞/—Å—É—Ç + –≤–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞.`);
                        plan.push(`   - –û–ê–ö, –±–∏–æ—Ö–∏–º–∏—è, –∫–æ–∞–≥—É–ª–æ–≥—Ä–∞–º–º–∞ - –∫–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–∏–º–ø—Ç–æ–º–æ–≤.`);
                        plan.push(`   - –¢–µ—Å—Ç –Ω–∞ –ø—Ä–æ—Ç–µ–∏–Ω—É—Ä–∏—é –ø—Ä–∏ –∫–∞–∂–¥–æ–π —è–≤–∫–µ.`);
                    } else {
                         plan.push(`2. –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –ü–≠: –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∞—è –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–∑–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è –Ω–µ –ø–æ–∫–∞–∑–∞–Ω–∞.`);
                    }

                    if (isHighRiskFGR) {
                        plan.push(`3. –ú–û–ù–ò–¢–û–†–ò–ù–ì –ó–†–ü (–ö–† 2024):`);
                        plan.push(`   - –£–ó-—Ñ–µ—Ç–æ–º–µ—Ç—Ä–∏—è –≤ –¥–∏–Ω–∞–º–∏–∫–µ (–∏–Ω—Ç–µ—Ä–≤–∞–ª 14-21 –¥–µ–Ω—å).`);
                        plan.push(`   - –î–æ–ø–ø–ª–µ—Ä–æ–º–µ—Ç—Ä–∏—è –º–∞—Ç–æ—á–Ω–æ-–ø–ª–∞—Ü–µ–Ω—Ç–∞—Ä–Ω–æ–≥–æ –∫—Ä–æ–≤–æ—Ç–æ–∫–∞.`);
                        plan.push(`   - –ö–¢–ì –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ —Å 26 –Ω–µ–¥–µ–ª—å (–ø—Ä–∏ –¥–∏–∞–≥–Ω–æ–∑–µ –ó–†–ü - 2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥).`);
                    } else {
                        plan.push(`3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–ª–æ–¥–∞: –ü–ª–∞–Ω–æ–≤—ã–µ —Å–∫—Ä–∏–Ω–∏–Ω–≥–æ–≤—ã–µ –£–ó–ò.`);
                    }

                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–µ–ª–∫–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –≤ –ø—Ä–æ—Ç–æ–∫–æ–ª–µ
                    const proteinCheckbox = document.getElementById('chk-protein-rec');
                    if (proteinCheckbox && proteinCheckbox.checked) {
                        plan.push(`4. –ù–£–¢–†–ò–¶–ò–û–õ–û–ì–ò–Ø:`);
                        plan.push(`   - –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–∏–µ—Ç—ã: –±–µ–ª–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ ‚â•70‚Äì90 –≥/—Å—É—Ç (–º—è—Å–æ, —Ä—ã–±–∞, –º–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã, –±–æ–±–æ–≤—ã–µ).`);
                    }

                    // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤—Ä–∞—á–∞, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                    const doctorNote = document.getElementById('doctor-comment').value.trim();
                    const doctorNoteText = doctorNote ? `\n\nIV. –û–°–û–ë–´–ï –û–¢–ú–ï–¢–ö–ò –í–†–ê–ß–ê:\n${doctorNote}` : '';

                    const expertText = `–ü–†–û–¢–û–ö–û–õ –û–¶–ï–ù–ö–ò –ò–ù–î–ò–í–ò–î–£–ê–õ–¨–ù–û–ì–û –†–ò–°–ö–ê (CDSS)
–î–∞—Ç–∞ —Ä–∞—Å—á–µ—Ç–∞: ${currentDate}
–§–ò–û: ${pName} (ID: ${pId})
–í–æ–∑—Ä–∞—Å—Ç: ${inputs.age} –ª–µ—Ç. –ò–ú–¢: ${bmiText}.

I. –ö–õ–ò–ù–ò–ß–ï–°–ö–ò–ô –î–ò–ê–ì–ù–û–ó (–ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–´–ô):
${diagnosisText}${comorbText}

II. –ü–†–û–ì–ù–û–ó –†–ê–ó–í–ò–¢–ò–Ø –û–°–õ–û–ñ–ù–ï–ù–ò–ô (AI-–ê–ù–ê–õ–ò–ó):
–ó–∞–∫–ª—é—á–µ–Ω–∏–µ: ${riskConclusion}
–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞:
- –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ü–≠: ${pePercent}% (–ü–æ—Ä–æ–≥ –æ—Ç—Å–µ—á–∫–∏ –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∏—Å–∫–∞: 57%).
- –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ó–†–ü: ${fgrPercent}% (–ü–æ—Ä–æ–≥ –æ—Ç—Å–µ—á–∫–∏ –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∏—Å–∫–∞: 39%).
–î–∞–Ω–Ω—ã–µ I —Å–∫—Ä–∏–Ω–∏–Ω–≥–∞: —Ä–∏—Å–∫ –ü–≠ ${inputs.scr_pe}, —Ä–∏—Å–∫ –ó–†–ü ${inputs.scr_fgr}.

III. –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–ù–´–ô –ü–õ–ê–ù –í–ï–î–ï–ù–ò–Ø (–°–æ–≥–ª–∞—Å–Ω–æ –ö–† –ú–ó –†–§):
${plan.join('\n')}${doctorNoteText}

–í—Ä–∞—á: ${pDoctor}
_______________________ (–ü–æ–¥–ø–∏—Å—å)`;
                    
                    cdssOutput.innerText = expertText;
                    
                    // –°–∫—Ä–æ–ª–ª –∫ –≤–µ—Ä—Ö—É –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —á–∞—Å—Ç–∏ –∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                    document.getElementById('input-column').scrollIntoView({ behavior: 'smooth', block: 'start' });

                } catch (e) {
                    alert("–û—à–∏–±–∫–∞: " + e.message);
                } finally {
                    trigger.innerHTML = originalText;
                    trigger.disabled = false;
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–í—ã–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª"
            document.getElementById('btn-protocol').addEventListener('click', () => {
                const textContent = document.getElementById('cdss-generated-text').innerText;
                
                if (!textContent) {
                    alert('–°–Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∏—Å–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.');
                    return;
                }

                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
                const pName = document.getElementById('header-name').value || '–ü–∞—Ü–∏–µ–Ω—Ç';
                const dateStr = new Date().toLocaleDateString('ru-RU').replace(/\./g, '-');
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞
                const filename = `${pName}_${dateStr}.txt`;
                
                // –°–æ–∑–¥–∞–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
                const blob = new Blob([textContent], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            });

            document.getElementById('copy-to-comment').addEventListener('click', () => {
                doctorComment.value = cdssOutput.innerText;
                doctorComment.focus();
            });

            const btnScreening = document.getElementById('mode-screening');
            const btnTactical = document.getElementById('mode-tactical');
            btnScreening.addEventListener('click', () => { btnScreening.classList.add('active-mode'); btnTactical.classList.remove('active-mode'); });
            btnTactical.addEventListener('click', () => { btnTactical.classList.add('active-mode'); btnScreening.classList.remove('active-mode'); });

            document.getElementById('import-mis').addEventListener('click', function() {
                // –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–æ–π, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ HTML (onclick) —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–∞–Ω—å—à–µ.
                // –ù–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ:
                /* this.innerHTML = '–ó–ê–ì–†–£–ó–ö–ê...';
                document.getElementById('input-column').classList.add('loading-mis');
                setTimeout(() => {
                    document.getElementById('input-column').classList.remove('loading-mis');
                    this.innerHTML = '–î–ê–ù–ù–´–ï –ó–ê–ì–†–£–ñ–ï–ù–´';
                }, 1000);
                */
            });
        });
    </script>
</body>
</html>
